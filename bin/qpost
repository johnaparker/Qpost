#!/usr/bin/env python3

import argparse
import qpost
import matplotlib.pyplot as plt
print("Qpost is working!")

# parse input
parser = argparse.ArgumentParser(prog='PROG')
subparsers = parser.add_subparsers(help='sub-command help', dest="command")
parser_a = subparsers.add_parser('flux', help='flux help')
parser_b = subparsers.add_parser('b', help='b help')

parser_a.add_argument('h5file', type=str, help='HDF5 file to be used')
parser_a.add_argument('dataset', type=str, help='Dataset inside HDF5 file to be used')
parser_b.add_argument('foo', type=int, help='foo help')

args = parser.parse_args()

if args.command == "flux":
    print("Flux calculation")
    # index = args.h5file.find(':')
    # h5file = args.h5file[:index]
    # dataname = args.h5file[index+1:]
    # flux = qpost.monitors.load_flux(h5file, dataname)
    flux = qpost.monitors.load_flux(args.h5file, args.dataset)
    plt.plot(flux, '.')
    plt.show()
    
